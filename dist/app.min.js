class App{constructor(t,e,i,n,o,s,r,a,l,h,c){this.$input=t,this.$title=e,this.$link=i,this.soundEngine=n,this.noteEngine=o,this.chordEngine=s,this.scaleEngine=r,this.commandEngine=a,this.pianoView=l,this.parser=h,this.settings=c,this.activeNotes=null,this.highlightedNotes=null,this.rootNotes=null}updateActiveNotes(t){this.activeNotes=t,this.activeNotes?this.soundEngine.queueNotes(this.activeNotes,this.rootNotes):this.soundEngine.clear(),this.draw()}draw(){this.activeNotes?this.pianoView.draw(this.activeNotes,this.highlightedNotes,this.rootNotes):this.pianoView.clear()}process(t){if(!t||0==t.length)return null;if(this.$input.classList.remove(Config.validCommandCSSClass),this.commandEngine.isCommand(t))return this.commandEngine.isValidCommand(t)&&this.$input.classList.add(Config.validCommandCSSClass),null;if(this.rootNotes=this.noteEngine.getNotesFromQuery(t),t.includes("root")&&this.rootNotes.length>0)return this.rootNotes;const e=this.scaleEngine.getNotesFromQuery(t);if(e.length>0)return e;const i=this.chordEngine.getNotesFromQuery(t);return i.length>0?i:null}updateLink(t){const e=this.parser.getURLFromQuery(t);this.$link.classList.remove(Config.hiddenCSSClass),e?this.$link.href=e:this.$link.classList.add(Config.hiddenCSSClass)}toggleSoundEngine(t){t.includes("play")?(this.pianoView.isLEDOn=!0,this.soundEngine.isPlaying||this.soundEngine.play()):(this.pianoView.isLEDOn=!1,this.soundEngine.stop(),this.highlightedNotes=null)}processInput(){const t=this.$input.value,e=this.process(t);this.updateLink(t),this.toggleSoundEngine(t),this.updateActiveNotes(e)}start(){const t=this.parser.getQueryFromURL(window.location.href);t&&(this.$input.value=t,this.processInput()),window.onresize=function(){this.draw()}.bind(this),this.$input.onkeyup=function(t){t.preventDefault(),13==t.keyCode?(this.commandEngine.execute(this.$input.value),this.$input.classList.remove(Config.validCommandCSSClass),this.$input.value="",this.processInput()):38==t.keyCode?(this.$input.value=this.parser.transposeQuery(this.$input.value,1),this.processInput()):40==t.keyCode&&(this.$input.value=this.parser.transposeQuery(this.$input.value,-1),this.processInput())}.bind(this),this.$input.onkeydown=function(t){38==t.keyCode?t.preventDefault():40==t.keyCode&&t.preventDefault()}.bind(this),this.$input.oninput=function(){this.processInput()}.bind(this),this.$title.onclick=function(t){this.settings.toggleTheme(),this.draw()}.bind(this),this.soundEngine.playCallback=function(t){this.highlightedNotes=[t],this.draw()}.bind(this),this.$input.focus(),this.draw()}}class CanvasHelper{constructor(t){this.ctx=t,this.fillStyle="",this.highlightStyle="",this.shadowStyle="",this.highlightSpeckStyle="",this.highlightSize=0,this.shadowSize=0}fillRect(t,e,i,n){this.ctx.fillStyle=this.fillStyle,this.ctx.fillRect(t,e,i,n),this.ctx.fillStyle=this.shadowStyle,this.ctx.fillRect(t,e+n-this.shadowSize,i,this.shadowSize),this.ctx.fillRect(t+i-this.shadowSize,e,this.shadowSize,n);const o=this.highlightSize;this.ctx.beginPath(),this.ctx.moveTo(t,e+n),this.ctx.lineTo(t+o,e+n-o),this.ctx.lineTo(t+o,e+o),this.ctx.lineTo(t+i-o,e+o),this.ctx.lineTo(t+i,e),this.ctx.lineTo(t,e),this.ctx.closePath();let s=this.ctx.createLinearGradient(t,e,t+i,e);s.addColorStop(0,this.highlightStyle),s.addColorStop(.3,this.highlightSpeckStyle),s.addColorStop(1,this.highlightStyle),this.ctx.fillStyle=s,this.ctx.fill()}}class ChordEngine{constructor(t){this.parser=t}getNotesFromSymbol(t){let e=[];const i=this.parser.findRoot(t);if(!i)return[];const n=this.parser.noteStringToIndex(i);if(!n)return[];let o=this.parser.findFlats(t),s=this.parser.findSharps(t),r=n+4;t.includes("m")&&!t.includes("maj")&&(r=n+3),t.includes(i+"-")&&(r=n+3),t.includes("dim")&&(r=n+3),t.includes("sus4")&&(r=n+5),t.includes("sus2")&&(r=n+2);let a=n+7;t.includes("dim")&&(a=n+6),t.includes("b5")&&(a=n+6),t.includes("#5")&&(a=n+8),t.includes("+5")&&(a=n+8),t.includes("+7")&&(a=n+8),t.includes("aug")&&(a=n+8);let l=n;t.includes("6")&&(l=n+9);let h=n;t.includes("7")&&(h=n+10),t.includes("9")&&(h=n+10),t.includes("11")&&(h=n+10),t.includes("13")&&(h=n+10),t.includes("M7")&&(h=n+11),t.includes("M9")&&(h=n+11),t.includes("M11")&&(h=n+11),t.includes("M13")&&(h=n+11),t.includes("maj7")&&(h=n+11),t.includes("maj9")&&(h=n+11),t.includes("maj11")&&(h=n+11),t.includes("maj13")&&(h=n+11),t.includes("dim")&&h==n+10&&h--;let c=n;o.includes(9)||s.includes(9)||(t.includes("9")&&(c=n+14),t.includes("11")&&(c=n+14),t.includes("13")&&(c=n+14));let u=n;o.includes(11)||s.includes(11)||(t.includes("11")&&(u=n+17),t.includes("13")&&(u=n+17));let d=n;o.includes(13)||s.includes(13)||t.includes("13")&&(d=n+21);let g=function(t){let i=t%Config.totalNotes;0==i&&(i=12),e.includes(i)||e.push(i)};const p=MusicLibrary.scaleIntervals.major;return o.forEach(function(t,e,i){let o=0,s=n;for(o=0;o<t-1;o++)s+=p[o%p.length];g(s-1)}),s.forEach(function(t,e,i){let o=0,s=n;for(o=0;o<t-1;o++)s+=p[o%p.length];g(s+1)}),g(n),g(r),g(a),g(l),g(h),g(c),g(u),g(d),e.sort((t,e)=>t-e)}getNotesFromQuery(t){let e=[];const i=this.parser.findSymbols(t);return i?(i.forEach(function(t,i,n){this.getNotesFromSymbol(t).forEach(function(t,i,n){e.includes(t)||e.push(t)})},this),e.sort((t,e)=>t-e)):[]}}class CommandEngine{constructor(t){this.settings=t,this.lettersKeyword="letters",this.showKeyword="show",this.hideKeyword="hide"}isCommand(t){if(!t)return!1;const e=t.trim();return e[0]==this.showKeyword[0]||e[0]==this.hideKeyword[0]}isValidCommand(t){if(!this.isCommand(t))return!1;const e=t.includes(this.lettersKeyword),i=t.includes(this.showKeyword),n=t.includes(this.hideKeyword);return e&&(i||n)}execute(t){if(!this.isValidCommand(t))return!1;const e=t.includes(this.lettersKeyword),i=t.includes(this.showKeyword),n=t.includes(this.hideKeyword);return e&&(i?this.settings.isShowingLetters=!0:n&&(this.settings.isShowingLetters=!1)),!0}}class Config{static get totalOctaves(){return 3}static get notesPerOctave(){return 12}static get totalNotes(){return this.totalOctaves*this.notesPerOctave}static get validCommandCSSClass(){return"valid-command"}static get hiddenCSSClass(){return"hidden"}}document.addEventListener("DOMContentLoaded",function(t){let e=document.getElementById("query"),i=document.getElementById("canvas"),n=document.getElementById("piano-title"),o=document.getElementById("link");const s=new Parser,r=new Settings,a=new PianoView(i,r,s),l=new SoundEngine(s),h=new NoteEngine(s),c=new ChordEngine(s),u=new ScaleEngine(s),d=new CommandEngine(r);new App(e,n,o,l,h,c,u,d,a,s,r).start()});class MusicLibrary{static get scaleIntervals(){return{chromatic:[1,1,1,1,1,1,1,1,1,1,1,1],minor:[2,1,2,2,1,2,2],"natural minor":[2,1,2,2,1,2,2],major:[2,2,1,2,2,2,1],ionian:[2,2,1,2,2,2,1],dorian:[2,1,2,2,2,1,2],phrygian:[1,2,2,2,1,2,2],lydian:[2,2,2,1,2,2,1],mixolydian:[2,2,1,2,2,1,2],aeolian:[2,1,2,2,1,2,2],locrian:[1,2,2,1,2,2,2],"melodic minor":[2,1,2,2,2,2,1],"jazz minor":[2,1,2,2,2,2,1],"dorian #7":[2,1,2,2,2,2,1],"phrygian #6":[1,2,2,2,2,1,2],"dorian b2":[1,2,2,2,2,1,2],"lydian augmented":[2,2,2,2,1,2,1],"lydian #5":[2,2,2,2,1,2,1],overtone:[2,2,2,1,2,1,2],acoustic:[2,2,2,1,2,1,2],"lydian dominant":[2,2,2,1,2,1,2],"lydian b7":[2,2,2,1,2,1,2],"mixolydian #4":[2,2,2,1,2,1,2],"mixolydian #11":[2,2,2,1,2,1,2],"dominant #11":[2,2,2,1,2,1,2],"mixolydian b6":[2,2,1,2,1,2,2],"mixolydian b13":[2,2,1,2,1,2,2],"aeolian dominant":[2,2,1,2,1,2,2],"aeolian major":[2,2,1,2,1,2,2],"melodic major":[2,2,1,2,1,2,2],"aeolian #3":[2,2,1,2,1,2,2],"locrian #2":[2,1,2,1,2,2,2],"half diminished":[2,1,2,1,2,2,2],"locrian natural 9":[2,1,2,1,2,2,2],"super locrian":[1,2,1,2,2,2,2],altered:[1,2,1,2,2,2,2],"altered dominant":[1,2,1,2,2,2,2],pomeroy:[1,2,1,2,2,2,2],ravel:[1,2,1,2,2,2,2],"diminished whole tone":[1,2,1,2,2,2,2],"dominant whole tone":[1,2,1,2,2,2,2],"locrian b4":[1,2,1,2,2,2,2],"ionian #1":[1,2,1,2,2,2,2],"harmonic minor":[2,1,2,2,1,3,1],"aeolian #7":[2,1,2,2,1,3,1],"locrian #6":[1,2,2,1,3,1,2],"ionian #5":[2,2,1,3,1,2,1],"dorian #4":[2,1,3,1,2,1,2],"dorian #11":[2,1,3,1,2,1,2],"phrygian major":[1,3,1,2,1,2,2],"phrygian dominant":[1,3,1,2,1,2,2],"phrygian #3":[1,3,1,2,1,2,2],"lydian #2":[3,1,2,1,2,2,1],"alt dominant":[1,2,1,2,2,1,3],"mixolydian #1":[1,2,1,2,2,1,3],"harmonic major":[2,2,1,2,1,3,1],"ionian b6":[2,2,1,2,1,3,1],"dorian b5":[2,1,2,1,3,1,2],"phrygian b4":[1,2,1,3,1,2,2],"lydian b3":[2,1,3,1,2,2,1],"mixolydian b2":[1,3,1,2,2,1,2],"aeolian b1":[3,1,2,2,1,2,1],"locrian b7":[1,2,2,1,2,1,3],"pentatonic major":[2,2,3,2,3],"pentatonic minor":[3,2,2,3,2],"pentatonic blues":[3,2,1,1,3,2],"pentatonic neutral":[2,3,2,3,2],blues:[3,2,1,1,3,2],"minor blues":[3,2,1,1,3,2],"major blues":[2,1,1,3,2,3],whole:[2,2,2,2,2,2],"half whole":[1,2,1,2,1,2,1,2],"dominant diminished":[1,2,1,2,1,2,1,2],"whole half":[2,1,2,1,2,1,2,1],diminished:[2,1,2,1,2,1,2,1],algerian:[2,1,2,1,1,1,3,1],arabic:[2,2,1,1,2,2,2],byzantine:[1,3,1,2,1,3,2],chinese:[4,2,1,4,1],egyptian:[2,3,2,3,2],"eight tone spanish":[1,2,1,1,1,2,2,2],enigmatic:[1,3,2,2,2,1,1],"enigmatic minor":[1,2,3,1,3,1,1],geez:[2,1,2,2,1,2,2],hindu:[2,2,1,2,1,2,2],hirajoshi:[1,4,1,4,2],hungarian:[2,1,3,1,1,2,1],japanese:[1,4,2,3,2],oriental:[1,3,1,1,3,1,2],"romanian minor":[2,1,3,1,2,1,2],"spanish gypsy":[1,3,1,2,1,2,2],maqam:[1,3,1,2,1,3,1],"bebop major":[2,2,1,2,1,1,2,1],bebop:[2,2,1,2,1,1,2,1],"bebop minor":[2,1,1,1,2,2,1,2],"bebop dominant":[2,2,1,2,2,1,1,1],"bebop dorian":[2,1,2,2,2,1,1,1],"nine tone":[2,1,1,2,1,1,1,2,1]}}static get scaleNames(){return Object.keys(MusicLibrary.scaleIntervals).sort(function(t,e){return e.length-t.length})}static get sharpNoteNames(){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"]}static get flatNoteNames(){return["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"]}static get altNoteNames(){return["B#","_","_","_","Fb","E#","_","_","_","_","_","Cb"]}}class NoteEngine{constructor(t){this.parser=t}getNotesFromSymbol(t){const e=this.parser.findRoot(t);if(!e)return[];const i=this.parser.noteStringToIndex(e);return i?[i]:[]}getNotesFromQuery(t){let e=[];const i=this.parser.findSymbols(t);return i?(i.forEach(function(t,i,n){const o=this.getNotesFromSymbol(t);e=e.concat(o)},this),e):[]}}class Parser{transposeNote(t,e){let i=MusicLibrary.sharpNoteNames.indexOf(t);if(i<0&&(i=MusicLibrary.flatNoteNames.indexOf(t)),i<0)return t;i+=e,(i%=Config.notesPerOctave)<0&&(i=Config.notesPerOctave+i);let n=t;return n=e<0?MusicLibrary.flatNoteNames[i]:MusicLibrary.sharpNoteNames[i]}transposeQuery(t,e){if(!this.findRoot(t))return t;let i=/[ABCDEFG]b?#?/g,n=null,o=[],s=[],r=0;for(;null!=(n=i.exec(t));)o.push(n.index),s.push(n[0]),r++;let a=t,l=0;for(l=r-1;l>=0;l--){const t=o[l],i=s[l],n=this.transposeNote(i,e);a=a.substr(0,t)+n+a.substr(t+i.length)}return a}areSameRootNotes(t,e){return!(!t||!e)&&t%12==e%12}includesRoot(t,e){if(!t||!e)return!1;let i=!1;for(let n=0;n<t.length;n++){const o=t[n];if(this.areSameRootNotes(e,o)){i=!0;break}}return i}findNotes(t){if(!t)return null;const e=t.match(/[ABCDEFG]b?#?/g);return e?e.map(function(t){return"Cb"==t?"B":"B#"==t?"C":"E#"==t?"F":"Fb"==t?"E":t}):null}findSymbols(t){if(!t)return null;const e=t.match(/[ABCDEFG](b?#?)([^ABCDEFG])*/g);return e?e.map(function(t){return t.trim().replace(/\s+/g," ")}):null}hasIsolatedRoot(t){return!!t&&t.search(/[ABCDEFG]b?#?(\s|$)/g)>=0}findRoot(t){if(!t)return null;const e=t.match(/[ABCDEFG]b?#?/);return e&&e.length>0?e[0]:null}findOctave(t){if(!t)return null;const e=t.match(/[ABCDEFG](#|b)?\d+/);if(!e||0==e.length)return null;const i=e[0].match(/\d+/);return i&&i.length>0?parseInt(i[0],10):null}noteStringToIndex(t){let e=MusicLibrary.sharpNoteNames.indexOf(t);return e<0&&(e=MusicLibrary.flatNoteNames.indexOf(t)),e<0&&(e=MusicLibrary.altNoteNames.indexOf(t)),e<0?null:e+1}findFlats(t){if(!t)return[];const e=t.replace(/([ABCDEFG](b|#)?)-?\d+/g,"").match(/(b|-)\d+/g);if(!e)return[];const i=[];return e.forEach(function(t,e,n){const o=parseInt(t.slice(1),10);i.includes(o)||i.push(o)}),i}findSharps(t){if(!t)return[];const e=t.replace(/([ABCDEFG](b|#)?)\+?\d+/g,"").match(/(#|\+)\d+/g);if(!e)return[];const i=[];return e.forEach(function(t,e,n){const o=parseInt(t.slice(1),10);i.includes(o)||i.push(o)}),i}getQueryFromURL(t){if(!t)return null;let e=new RegExp("[?&]q(=([^&#]*)|&|#|$)").exec(t);if(!e)return null;if(!e[2])return null;const i=decodeURIComponent(e[2].replace(/\+/g," ")).trim();return 0==i.length?null:i}getURLFromQuery(t){return t&&0!=t.trim().length?"?q="+encodeURIComponent(t.trim()):null}}class PianoView{constructor(t,e,i){this.$canvas=t,this.settings=e,this.parser=i,this.isLEDOn=!1}clear(){this.draw([],[],[])}drawShadow(t,e,i,n,o,s,r){const a=Math.max(s,r);let l={x:0,y:0},h={x:0,y:0};t.beginPath();let c=e,u=i+o;t.moveTo(c,u),c+=a,u+=a,l.x=.5*c,l.y=.5*u,t.lineTo(c,u),c+=n,u-=o,t.lineTo(c,u),c=e+n,u=i,h.x=.5*c,h.y=.5*u,t.lineTo(c,u),t.closePath();let d=t.createLinearGradient(l.x,l.y,h.x,h.y);d.addColorStop(0,this.settings.activeTheme().primaryShadowColor2),d.addColorStop(1,this.settings.activeTheme().primaryShadowColor1),t.fillStyle=d,t.fill()}draw(t,e,i){if(!this.$canvas.getContext)return;document.body.classList="",document.body.classList.add(this.settings.activeTheme().cssClass);const n=window.innerWidth,o=window.innerHeight,s=n/2-150,r=o/2-40;this.$canvas.width=n,this.$canvas.height=o;const a=s+8,l=r+35,h=Config.totalOctaves,c=Config.notesPerOctave,u=[1,3,5,6,8,10,12],d=[2,4,7,9,11],g=7*h,p=5*h,f=284/g,m=.6*f,C=this.$canvas.getContext("2d");C.fillStyle=this.settings.activeTheme().primaryBackgroundColor,C.fillRect(0,0,n,o),this.drawShadow(C,s,r,300,80,n,o);const y=new CanvasHelper(C);y.fillStyle=this.settings.activeTheme().pianoBackgroundColor,y.highlightStyle=this.settings.activeTheme().pianoHighlightColor,y.highlightSpeckStyle=this.settings.activeTheme().pianoHighlightSpeckColor,y.shadowStyle=this.settings.activeTheme().pianoShadowColor,y.highlightSize=2,y.shadowSize=2,y.fillRect(s,r,300,80),C.fillStyle=this.settings.activeTheme().pianoKeybedBackgroundColor,C.fillRect(a,l,284,40),C.beginPath(),C.moveTo(a+1,r+80-5),C.lineTo(a+5+1,r+80),C.lineTo(s+300,r+80),C.lineTo(s+300-8,r+80-5),C.closePath(),C.fillStyle=this.settings.activeTheme().pianoShadowColor,C.fill();let S=50;for(let t=0;t<3;t++)C.fillStyle=this.settings.activeTheme().pianoStripeColor,C.fillRect(s+300-S,r+2,5,33),C.fillStyle=this.settings.activeTheme().pianoStripeHighlightColor,C.fillRect(s+300-S,r,5,2),S-=10;const b=.70710678118;let v=20;for(let t=0;t<3;t++){const t=v,e=18.5,i=t-6*b,n=e+6*b,o=i+(35-n),a=35,l=t+6*b,h=e-6*b,c=l+(35-h),u=35;C.beginPath(),C.moveTo(s+i,r+n),C.lineTo(s+o,r+a),C.lineTo(s+c,r+u),C.lineTo(s+l,r+h),C.closePath(),C.fillStyle=this.settings.activeTheme().pianoKnobShadowColor,C.fill();let d=C.createLinearGradient(s+t-6,r+e-6,s+t+6,r+e+6);d.addColorStop(0,this.settings.activeTheme().pianoOuterKnobHighlightColor),d.addColorStop(1,this.settings.activeTheme().pianoOuterKnobColor),C.fillStyle=d,C.beginPath(),C.arc(s+t,r+e,6,0,2*Math.PI,!1),C.closePath(),C.fill(),C.fillStyle=this.settings.activeTheme().pianoInnerKnobColor,C.beginPath(),C.arc(s+t,r+e,4,0,2*Math.PI,!1),C.closePath(),C.fill(),v+=22}C.beginPath(),C.arc(s+300-12,r+12,2,0,2*Math.PI,!1),C.closePath(),C.strokeStyle=this.settings.activeTheme().pianoLEDBorderColor,C.lineWidth=1,this.isLEDOn?C.fillStyle=this.settings.activeTheme().pianoLEDOnColor:C.fillStyle=this.settings.activeTheme().pianoLEDOffColor,C.fill(),C.stroke();let w=0,N=0;for(w=0;w<g;w++){N=Math.floor(w/7);const n=w*f+a+1,o=l,s=f-1,r=40,h=u[w%u.length]+N*c;let d=this.settings.activeTheme().pianoDarkTextColor;if(t.includes(h)){d=this.settings.activeTheme().pianoLightTextColor;let t=this.settings.activeTheme().pianoNoteSelectedColor,a=this.settings.activeTheme().pianoNoteSelectedShadowColor;e&&e.includes(h)&&(t=this.settings.activeTheme().pianoNoteHighlightedColor,a=this.settings.activeTheme().pianoNoteHighlightedShadowColor),C.fillStyle=t,C.fillRect(n,o,s,r),C.fillStyle=a,C.fillRect(n,o,s,2),C.beginPath(),C.moveTo(n,o),C.lineTo(n,o+r),C.lineTo(n+s/3,o+r),C.lineTo(n+2,o),C.closePath(),C.fillStyle=a,C.fill(),this.parser.includesRoot(i,h)&&(C.fillStyle=this.settings.activeTheme().pianoNoteRootDotColor,C.beginPath(),C.arc(n+s/2,o+r-6,3,0,2*Math.PI,!1),C.closePath(),C.fill())}else C.fillStyle=this.settings.activeTheme().pianoWhiteNoteColor,C.fillRect(n,o,s,r),C.fillStyle=this.settings.activeTheme().pianoWhiteNoteShadowColor,C.fillRect(n,o,s,2);if(this.settings.isShowingLetters){let t=["C","D","E","F","G","A","B"];C.font=this.settings.activeTheme().pianoLettersFont,C.fillStyle=d,C.fillText(t[w%t.length],3+n,o+r-3)}}const T=[1,1,2,2,2];N=0;const E=284/h;for(w=0;w<p;w++){N=Math.floor(w/5);const n=w%T.length,o=N*E+(n+T[n])*f-m/2+a,s=l,r=m,h=28,u=d[w%d.length]+N*c;if(t.includes(u)){let t=this.settings.activeTheme().pianoNoteSelectedColor,n=this.settings.activeTheme().pianoNoteSelectedShadowColor;e&&e.includes(u)&&(t=this.settings.activeTheme().pianoNoteHighlightedColor,n=this.settings.activeTheme().pianoNoteHighlightedShadowColor),C.fillStyle=t,C.fillRect(o,s,r,h),C.fillStyle=n,C.fillRect(o,s,r,2),C.fillRect(o,s,2,h),C.fillRect(o,s+h-2,r,2),this.parser.includesRoot(i,u)&&(C.fillStyle=this.settings.activeTheme().pianoNoteRootDotColor,C.beginPath(),C.arc(o+r/2,s+h-6,2,0,2*Math.PI,!1),C.closePath(),C.fill())}else C.fillStyle=this.settings.activeTheme().pianoBlackNoteColor,C.fillRect(o,s,r,h),C.fillStyle=this.settings.activeTheme().pianoBlackNoteHighlightColor,C.fillRect(o,s+h-4,r,4)}}}class ScaleEngine{constructor(t){this.parser=t}isScale(t){return new RegExp("[ABCDEFG](#|b)?\\s+("+MusicLibrary.scaleNames.join("|")+")","gi").test(t)}getNotesFromSymbol(t){if(!this.isScale(t))return[];const e=this.parser.findRoot(t);if(!e)return[];const i=this.parser.noteStringToIndex(e);if(!i)return[];let n=[];const o=MusicLibrary.scaleNames;for(let e in o){const s=o[e];if(t.toLowerCase().includes(s)){let t=i;MusicLibrary.scaleIntervals[s].forEach(function(e,i,o){n.push(t),t+=e});break}}let s=n.slice(0),r=1;for(r=1;r<Config.totalOctaves;r++)s=s.map(function(t){const e=t+Config.notesPerOctave;return e==Config.totalNotes?e:e%Config.totalNotes}),n=n.concat(s);return n.sort((t,e)=>t-e)}getNotesFromQuery(t){let e=[];const i=this.parser.findSymbols(t);return i?(i.forEach(function(t,i,n){this.getNotesFromSymbol(t).forEach(function(t,i,n){e.includes(t)||e.push(t)})},this),e.sort((t,e)=>t-e)):[]}}class Settings{constructor(){this.isShowingLetters=!1,this.activeThemeIndex=0}activeTheme(){return Themes.all[this.activeThemeIndex]}toggleTheme(){this.activeThemeIndex++,this.activeThemeIndex>=Themes.all.length&&(this.activeThemeIndex=0)}}class SoundEngine{constructor(t){this.synth=(new Tone.Synth).toMaster(),this.playCallback=null,this.parser=t,this.baseOctave=4,this.isPlaying=!1}noteIndexToString(t){const e=t-1,i=Math.floor(e/12)+this.baseOctave,n=e%MusicLibrary.flatNoteNames.length;return MusicLibrary.flatNoteNames[n]+i.toString()}noteStringToIndex(t){const e=this.parser.findRoot(t);let i=this.parser.findOctave(t);return i?i-=this.baseOctave:i=0,this.parser.noteStringToIndex(e)+i*Config.notesPerOctave}clear(){this.sequence&&this.sequence.removeAll()}queueNotes(t,e){const i=this.isPlaying;this.stop();let n=-1;for(let i in e)if((n=t.indexOf(e[i]))>=0)break;n<0&&(n=0);let o=[],s=n;for(let e in t){const e=this.noteIndexToString(t[s]);o.push(e),++s>=t.length&&(s=0)}const r=this;this.sequence=new Tone.Sequence(function(t,e){r.synth.triggerAttackRelease(e,"8n",t),r.playCallback&&r.playCallback(r.noteStringToIndex(e))},o,"4n"),i&&this.play()}play(){this.isPlaying=!0,this.sequence&&this.sequence.start(),Tone.Transport.start()}stop(){this.isPlaying=!1,this.sequence&&(this.sequence.stop(),this.sequence.removeAll(),this.sequence.dispose()),Tone.Transport.stop(),this.sequence=null}}class Themes{static get all(){return[ThemeRed,ThemeBlue]}}class ThemeRed{static get cssClass(){return"theme-red"}static get pianoBackgroundColor(){return"#db7a7a"}static get pianoHighlightColor(){return"#e58a8a"}static get pianoHighlightSpeckColor(){return"#e8c5c5"}static get pianoShadowColor(){return"#b23b3b"}static get pianoKeybedBackgroundColor(){return"#6c0b0b"}static get pianoDarkTextColor(){return"#888"}static get pianoLightTextColor(){return"#DDD"}static get pianoNoteSelectedColor(){return"#1ba7d1"}static get pianoNoteSelectedShadowColor(){return"#077c9f"}static get pianoNoteHighlightedColor(){return"#56deff"}static get pianoNoteHighlightedShadowColor(){return"#13b4db"}static get pianoNoteRootDotColor(){return"#FFF"}static get pianoWhiteNoteColor(){return"#FFF"}static get pianoWhiteNoteShadowColor(){return"#CCC"}static get pianoBlackNoteColor(){return"#333"}static get pianoBlackNoteHighlightColor(){return"#555"}static get pianoLettersFont(){return"8px sans-serif"}static get pianoStripeColor(){return"#e09191"}static get pianoStripeHighlightColor(){return"#e6a9a9"}static get pianoInnerKnobColor(){return"#af4646"}static get pianoOuterKnobColor(){return"#c48282"}static get pianoOuterKnobHighlightColor(){return"#ffffff"}static get pianoKnobShadowColor(){return"#be4f4f"}static get pianoLEDOnColor(){return"#fffa80"}static get pianoLEDOffColor(){return"#333"}static get pianoLEDBorderColor(){return"#edcfcf"}static get primaryBackgroundColor(){return"#7CBFDA"}static get primaryShadowColor1(){return"#6EAAC2"}static get primaryShadowColor2(){return"#7CBFDA"}}class ThemeBlue{static get cssClass(){return"theme-blue"}static get pianoBackgroundColor(){return"#6bbde2"}static get pianoHighlightColor(){return"#b3d4f0"}static get pianoHighlightSpeckColor(){return"#cfe1f0"}static get pianoShadowColor(){return"#307bbc"}static get pianoDarkTextColor(){return"#888"}static get pianoLightTextColor(){return"#DDD"}static get pianoNoteSelectedColor(){return"#1ba7d1"}static get pianoNoteSelectedShadowColor(){return"#077c9f"}static get pianoNoteHighlightedColor(){return"#56deff"}static get pianoNoteHighlightedShadowColor(){return"#13b4db"}static get pianoNoteRootDotColor(){return"#FFF"}static get pianoWhiteNoteColor(){return"#FFF"}static get pianoWhiteNoteShadowColor(){return"#CCC"}static get pianoBlackNoteColor(){return"#333"}static get pianoBlackNoteHighlightColor(){return"#555"}static get pianoLettersFont(){return"8px sans-serif"}static get pianoStripeColor(){return"#97c7f0"}static get pianoStripeHighlightColor(){return"#c4e2fc"}static get pianoInnerKnobColor(){return"#1c5d95"}static get pianoOuterKnobColor(){return"#84c6ff"}static get pianoOuterKnobHighlightColor(){return"#ffffff"}static get pianoKnobShadowColor(){return"#5495cc"}static get pianoLEDOnColor(){return"#fffa80"}static get pianoLEDOffColor(){return"#333"}static get pianoLEDBorderColor(){return"#b6d8f5"}static get primaryBackgroundColor(){return"#e2988e"}static get primaryShadowColor1(){return"#d17669"}static get primaryShadowColor2(){return"#e2988e"}}